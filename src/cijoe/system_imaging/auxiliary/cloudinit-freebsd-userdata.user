#cloud-config
disable_root: false
ssh_pwauth: true

chpasswd:
  expire: false
  users:
    - name: root
      password: root
      type: text

package_update: true
package_upgrade: true
packages:
  - fio
  - htop
  - nvme-cli
  - pciutils

runcmd:
  - [sed, -E, -i.bak, 's/auth[[:space:]]+required[[:space:]]+pam_unix\.so[[:space:]]+no_warn[[:space:]]+try_first_pass/& nullok/', /etc/pam.d/sshd]
  - echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
  - echo "PermitEmptyPasswords yes" >> /etc/ssh/sshd_config
  - echo "PasswordAuthentication yes" >> /etc/ssh/sshd_config
  - service sshd restart 

final_message: "The system is finally up, after $UPTIME seconds"

power_state:
  mode: poweroff
  message: So long and thanks for all the fish
  timeout: 30
  condition: true
